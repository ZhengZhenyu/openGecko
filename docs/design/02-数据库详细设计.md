# openGecko - 数据库详细设计文档

**文档版本**: v3.0
**更新日期**: 2026-02-21
**数据库类型**: SQLite 3.35+ (开发) / PostgreSQL 15+ (生产)

---

## 1. 数据库概览

### 1.1 设计原则

| 原则 | 说明 |
|------|------|
| **多租户隔离** | community_id 作为行级隔离字段，所有社区范围数据均须过滤 |
| **审计可追溯** | 关键操作记录到 audit_logs |
| **软删除** | 重要数据使用 is_active 标记而非物理删除 |
| **时间戳** | 关键表含 created_at / updated_at |
| **不可变创建者** | created_by_user_id 记录原始创建者，owner_id 支持转让 |
| **外键约束** | 保证数据完整性，删除级联策略明确 |

### 1.2 表清单（17 张）

| 表名 | 说明 | 隔离级别 |
|------|------|---------|
| users | 用户账号 | 全局 |
| community_users | 用户-社区多对多关联 | 社区级 |
| communities | 社区（租户）| 全局 |
| contents | 内容主表 | 社区级 |
| content_collaborators | 内容协作者关联 | 随内容 |
| content_assignees | 内容责任人关联 | 随内容 |
| publish_records | 发布记录 | 社区级 |
| content_analytics | 内容分析数据 | 随发布记录 |
| channel_configs | 渠道配置 | 社区级 |
| committees | 委员会 | 社区级 |
| committee_members | 委员会成员（外部人员）| 随委员会 |
| meetings | 会议 | 社区级 |
| meeting_assignees | 会议责任人（系统用户）关联 | 随会议 |
| meeting_reminders | 会议提醒记录 | 随会议 |
| meeting_participants | 会议与会人 | 随会议 |
| audit_logs | 审计日志 | 社区级 |
| password_reset_tokens | 密码重置令牌 | 全局 |

---

## 2. ER 图（Entity Relationship Diagram）

```mermaid
erDiagram
    communities ||--o{ community_users : "1:N"
    communities ||--o{ contents : "1:N"
    communities ||--o{ channel_configs : "1:N"
    communities ||--o{ audit_logs : "1:N"
    communities ||--o{ committees : "1:N"
    communities ||--o{ publish_records : "1:N"
    communities ||--o{ meetings : "1:N"

    users ||--o{ community_users : "1:N"
    users ||--o{ audit_logs : "1:N"
    users ||--o{ password_reset_tokens : "1:N"
    users ||--o{ content_collaborators : "1:N"
    users ||--o{ content_assignees : "1:N"
    users ||--o{ meeting_assignees : "1:N"

    contents ||--o{ publish_records : "1:N"
    contents ||--o{ content_collaborators : "1:N"
    contents ||--o{ content_assignees : "1:N"

    publish_records ||--o{ content_analytics : "1:N"

    committees ||--o{ committee_members : "1:N"
    committees ||--o{ meetings : "1:N"

    meetings ||--o{ meeting_assignees : "1:N"
    meetings ||--o{ meeting_reminders : "1:N"
    meetings ||--o{ meeting_participants : "1:N"
```

---

## 3. 表结构详细设计

### 3.1 users（用户表）

**用途**: 存储系统用户账号，支持全局超级管理员标记

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK, INDEX | 主键 |
| username | VARCHAR(100) | NOT NULL, UNIQUE, INDEX | 登录用户名 |
| email | VARCHAR(200) | NOT NULL, UNIQUE, INDEX | 邮箱，唯一 |
| hashed_password | VARCHAR(200) | NOT NULL | bcrypt 哈希密码 |
| full_name | VARCHAR(200) | DEFAULT '' | 用户全名/昵称 |
| is_active | BOOLEAN | DEFAULT TRUE | 是否激活（软删除）|
| is_superuser | BOOLEAN | DEFAULT FALSE | 超级管理员，可跨社区访问 |
| is_default_admin | BOOLEAN | DEFAULT FALSE | 标记初始默认管理员账号 |
| created_at | DATETIME | DEFAULT NOW | 创建时间 |

**业务规则**：
- `is_superuser=True` 的用户无需社区成员资格即可访问所有社区数据
- `is_default_admin=True` 的账号在创建正式管理员后自动删除（安全机制）
- 用户删除时相关内容的 `created_by_user_id` / `owner_id` 置为 NULL（SET NULL）

---

### 3.2 communities（社区表）

**用途**: 存储社区（租户）信息，每个社区是一个独立的数据隔离单元

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK, INDEX | 主键 |
| name | VARCHAR(200) | NOT NULL, UNIQUE, INDEX | 社区显示名称 |
| slug | VARCHAR(100) | NOT NULL, UNIQUE, INDEX | URL 友好标识 |
| description | TEXT | DEFAULT '' | 社区描述 |
| url | VARCHAR(500) | NULLABLE | 社区官网或仓库地址 |
| logo_url | VARCHAR(500) | NULLABLE | Logo 图片 URL |
| settings | JSON | DEFAULT {} | 社区级设置（时区、语言等）|
| is_active | BOOLEAN | DEFAULT TRUE | 是否活跃 |
| created_at | DATETIME | DEFAULT NOW | 创建时间 |
| updated_at | DATETIME | DEFAULT NOW, ON UPDATE | 更新时间 |

**业务规则**：
- `name` 和 `slug` 全局唯一
- 删除社区时级联删除：contents、channel_configs、audit_logs、committees

---

### 3.3 community_users（用户-社区关联表）

**用途**: 多对多关联，用户可属于多个社区，记录社区级角色

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK | 主键 |
| user_id | INTEGER | NOT NULL, FK(users.id CASCADE) | 用户 ID |
| community_id | INTEGER | NOT NULL, FK(communities.id CASCADE) | 社区 ID |
| role | VARCHAR(50) | DEFAULT 'user' | 角色：`admin` / `user` |
| joined_at | DATETIME | DEFAULT NOW | 加入时间 |

**约束**：`UNIQUE(user_id, community_id)` — 防止重复加入

**角色说明**：
- `admin`：社区管理员，可管理成员、内容、渠道配置
- `user`：普通成员，仅可操作自己负责的内容

---

### 3.4 contents（内容表）⭐ 核心表

**用途**: 存储所有内容记录，包含工作流状态、所有权、排期信息

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK, INDEX | 主键 |
| community_id | INTEGER | NOT NULL, FK, INDEX | **隔离字段** |
| created_by_user_id | INTEGER | FK(SET NULL), INDEX | 创建者（不可变）|
| owner_id | INTEGER | FK(SET NULL), INDEX | 当前所有者（可转让）|
| title | VARCHAR(500) | NOT NULL | 内容标题 |
| content_markdown | TEXT | DEFAULT '' | Markdown 正文 |
| content_html | TEXT | DEFAULT '' | HTML 正文（渲染缓存）|
| source_type | ENUM | DEFAULT 'contribution' | 来源类型 |
| source_file | VARCHAR(500) | NULLABLE | 上传的源文件名 |
| author | VARCHAR(200) | DEFAULT '' | 作者署名（可为外部人员）|
| tags | JSON | DEFAULT [] | 标签数组 |
| category | VARCHAR(100) | DEFAULT '' | 分类 |
| cover_image | VARCHAR(500) | NULLABLE | 封面图路径 |
| status | ENUM | DEFAULT 'draft' | 工作流状态 |
| work_status | VARCHAR(50) | DEFAULT 'planning', INDEX | 工作状态 |
| scheduled_publish_at | DATETIME | NULLABLE, INDEX | 计划发布时间（日历功能）|
| created_at | DATETIME | DEFAULT NOW | 创建时间 |
| updated_at | DATETIME | DEFAULT NOW, ON UPDATE | 更新时间 |

**枚举值**：

`source_type`：`contribution`（投稿）/ `release_note`（发版说明）/ `event_summary`（活动总结）

`status`（工作流状态）：

| 值 | 说明 | 可流转到 |
|----|------|---------|
| draft | 草稿 | reviewing、published |
| reviewing | 审核中 | approved、draft |
| approved | 已通过 | published、draft |
| published | 已发布 | — |

`work_status`（工作状态，独立于 status）：`planning` / `in_progress` / `completed`

**所有权模型**：
- `created_by_user_id`：不可变，记录原始创建者
- `owner_id`：可转让，控制主编辑权（默认等于创建者）
- `content_collaborators`：多对多协作编辑权
- `content_assignees`：多对多责任人（出现在个人工作台）

---

### 3.5 content_collaborators（内容协作者关联表）

**用途**: 记录内容的协作编辑者（拥有编辑权，但非所有者）

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK | 主键 |
| content_id | INTEGER | NOT NULL, FK(contents.id CASCADE) | 内容 ID |
| user_id | INTEGER | NOT NULL, FK(users.id CASCADE) | 用户 ID |
| added_at | DATETIME | DEFAULT NOW | 加入时间 |

---

### 3.6 content_assignees（内容责任人关联表）

**用途**: 记录内容的责任人（出现在个人工作台 `/my-work`）

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK | 主键 |
| content_id | INTEGER | NOT NULL, FK(contents.id CASCADE), INDEX | 内容 ID |
| user_id | INTEGER | NOT NULL, FK(users.id CASCADE), INDEX | 责任人 ID |
| assigned_at | DATETIME | DEFAULT NOW | 分配时间 |
| assigned_by_user_id | INTEGER | FK(users.id SET NULL), NULLABLE | 分配操作人 |

---

### 3.7 publish_records（发布记录表）

**用途**: 记录内容在各渠道的发布情况

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK, INDEX | 主键 |
| content_id | INTEGER | NOT NULL, FK(contents.id) | 关联内容 |
| community_id | INTEGER | NOT NULL, FK, INDEX | **隔离字段** |
| channel | ENUM | NOT NULL | 发布渠道 |
| status | ENUM | DEFAULT 'pending' | 发布状态 |
| platform_article_id | VARCHAR(200) | NULLABLE | 平台返回的文章 ID |
| platform_url | VARCHAR(500) | NULLABLE | 平台文章 URL |
| published_at | DATETIME | NULLABLE | 发布成功时间 |
| error_message | TEXT | NULLABLE | 失败时的错误信息 |
| created_at | DATETIME | DEFAULT NOW | 记录创建时间 |

**枚举值**：

`channel`：`wechat` / `hugo` / `csdn` / `zhihu`

`status`：

| 值 | 说明 |
|----|------|
| pending | 待发布 |
| draft | 草稿已创建（微信专用，等待人工发布）|
| published | 已发布 |
| failed | 发布失败 |

---

### 3.8 content_analytics（内容分析数据表）

**用途**: 存储各渠道的阅读、互动指标数据

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK, INDEX | 主键 |
| publish_record_id | INTEGER | NOT NULL, FK(publish_records.id) | 关联发布记录 |
| read_count | INTEGER | DEFAULT 0 | 阅读数 |
| like_count | INTEGER | DEFAULT 0 | 点赞数 |
| share_count | INTEGER | DEFAULT 0 | 分享数 |
| comment_count | INTEGER | DEFAULT 0 | 评论数 |
| collected_at | DATETIME | DEFAULT NOW | 数据采集时间 |

---

### 3.9 channel_configs（渠道配置表）

**用途**: 存储社区级渠道凭证配置（多租户隔离，凭证 Fernet 加密存储）

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK, INDEX | 主键 |
| community_id | INTEGER | NOT NULL, FK, INDEX | **隔离字段** |
| channel | VARCHAR(50) | NOT NULL | 渠道类型 |
| config | JSON | DEFAULT {} | 渠道配置（敏感字段 Fernet 加密）|
| enabled | BOOLEAN | DEFAULT FALSE | 是否启用 |

**约束**：`UNIQUE(community_id, channel)` — 每社区每渠道唯一

**config 字段结构示例**：

```json
// 微信公众号
{ "app_id": "wx1234...", "app_secret": "<Fernet加密密文>" }

// Hugo 博客
{ "repo_path": "/path/to/hugo/repo", "content_dir": "content/posts" }

// CSDN / 知乎
{ "cookie": "<Fernet加密Cookie>" }
```

---

### 3.10 committees（委员会表）

**用途**: 存储社区下的委员会/理事会信息

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK, INDEX | 主键 |
| community_id | INTEGER | NOT NULL, FK(CASCADE), INDEX | **隔离字段** |
| name | VARCHAR(200) | NOT NULL | 委员会名称 |
| slug | VARCHAR(100) | NOT NULL | URL 友好标识（NOT NULL）|
| description | TEXT | DEFAULT '' | 委员会描述 |
| is_active | BOOLEAN | DEFAULT TRUE | 是否活跃 |
| meeting_frequency | VARCHAR(50) | NULLABLE | 会议频率：monthly / quarterly / yearly |
| notification_email | VARCHAR(200) | NULLABLE | 通知邮件地址 |
| notification_wechat | VARCHAR(100) | NULLABLE | 通知微信群 |
| established_at | DATETIME | NULLABLE | 委员会成立时间 |
| created_at | DATETIME | DEFAULT NOW | 创建时间 |
| updated_at | DATETIME | DEFAULT NOW, ON UPDATE | 更新时间 |

**约束**：`UNIQUE(community_id, slug)` — 社区内 slug 唯一

---

### 3.11 committee_members（委员会成员表）

**用途**: 委员会外部成员信息（非系统用户，实名制管理）

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK, INDEX | 主键 |
| committee_id | INTEGER | NOT NULL, FK(CASCADE), INDEX | 所属委员会 |
| name | VARCHAR(200) | NOT NULL | 成员姓名 |
| email | VARCHAR(200) | NULLABLE, INDEX | 邮箱 |
| phone | VARCHAR(50) | NULLABLE | 电话 |
| wechat | VARCHAR(100) | NULLABLE | 微信号 |
| organization | VARCHAR(200) | NULLABLE | 所在机构 |
| gitcode_id | VARCHAR(100) | NULLABLE | GitCode 账号 |
| github_id | VARCHAR(100) | NULLABLE | GitHub 账号 |
| roles | JSON | DEFAULT [] | 角色标签（JSON 数组，可多选）|
| term_start | DATE | NULLABLE | 任期开始 |
| term_end | DATE | NULLABLE | 任期结束 |
| is_active | BOOLEAN | DEFAULT TRUE | 是否在任 |
| bio | TEXT | NULLABLE | 个人简介 |
| avatar_url | VARCHAR(500) | NULLABLE | 头像 URL |
| joined_at | DATETIME | DEFAULT NOW | 加入时间 |
| created_at | DATETIME | DEFAULT NOW | 创建时间 |
| updated_at | DATETIME | DEFAULT NOW, ON UPDATE | 更新时间 |

**`roles` 可选值**（JSON 数组）：`["主席", "副主席", "委员", "常务委员"]`

---

### 3.12 meetings（会议表）

**用途**: 存储委员会会议信息，支持状态追踪、议程纪要、责任人分配

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK, INDEX | 主键 |
| committee_id | INTEGER | NOT NULL, FK(CASCADE), INDEX | 所属委员会（NOT NULL）|
| community_id | INTEGER | NOT NULL, FK(CASCADE), INDEX | **隔离字段** |
| title | VARCHAR(500) | NOT NULL | 会议标题 |
| description | TEXT | NULLABLE | 会议描述 |
| scheduled_at | DATETIME | NOT NULL, INDEX | 计划时间 |
| duration | INTEGER | DEFAULT 120 | 持续时长（分钟）|
| location_type | VARCHAR(50) | NULLABLE | `online` / `offline` / `hybrid` |
| location | VARCHAR(500) | NULLABLE | 地点/会议链接 |
| status | VARCHAR(50) | DEFAULT 'scheduled', INDEX | 会议状态 |
| work_status | VARCHAR(50) | DEFAULT 'planning', INDEX | 工作状态 |
| agenda | TEXT | NULLABLE | 会议议程（Markdown）|
| minutes | TEXT | NULLABLE | 会议纪要（Markdown）|
| attachments | JSON | DEFAULT [] | 附件列表 `[{name, url}]` |
| reminder_sent | BOOLEAN | DEFAULT FALSE | 提醒是否已发送 |
| reminder_before_hours | INTEGER | DEFAULT 24 | 提前提醒小时数 |
| created_by_user_id | INTEGER | FK(SET NULL), NULLABLE | 创建者 |
| created_at | DATETIME | DEFAULT NOW | 创建时间 |
| updated_at | DATETIME | DEFAULT NOW, ON UPDATE | 更新时间 |

**注意**：`committee_id` 为 NOT NULL，创建会议前必须先创建委员会。

`status`（会议状态）：`scheduled` / `in_progress` / `completed` / `cancelled`

`work_status`（工作状态）：`planning` / `in_progress` / `completed`

---

### 3.13 meeting_assignees（会议责任人关联表）

**用途**: 会议与系统用户的多对多关联（出现在个人工作台）

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK | 主键 |
| meeting_id | INTEGER | NOT NULL, FK(meetings.id CASCADE), INDEX | 会议 ID |
| user_id | INTEGER | NOT NULL, FK(users.id CASCADE), INDEX | 责任人 ID |
| assigned_at | DATETIME | DEFAULT NOW | 分配时间 |
| assigned_by_user_id | INTEGER | FK(users.id SET NULL), NULLABLE | 分配操作人 |

---

### 3.14 meeting_reminders（会议提醒记录表）

**用途**: 记录每次会议提醒的发送状态

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK, INDEX | 主键 |
| meeting_id | INTEGER | NOT NULL, FK(CASCADE), INDEX | 所属会议 |
| reminder_type | VARCHAR(50) | NOT NULL | 提醒类型 |
| scheduled_at | DATETIME | NOT NULL | 计划发送时间 |
| sent_at | DATETIME | NULLABLE | 实际发送时间 |
| notification_channels | JSON | DEFAULT [] | 通知渠道 `['email', 'wechat']` |
| status | VARCHAR(50) | DEFAULT 'pending' | `pending` / `sent` / `failed` |
| error_message | TEXT | NULLABLE | 失败时错误信息 |
| created_at | DATETIME | DEFAULT NOW | 创建时间 |

**复合索引**：`(scheduled_at, status)` — 用于定时任务查询待发提醒

`reminder_type` 可选值：`preparation` / `one_week` / `three_days` / `one_day` / `two_hours`

---

### 3.15 meeting_participants（会议与会人表）

**用途**: 记录每次会议的实际参会人员（支持从委员会成员导入）

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK, INDEX | 主键 |
| meeting_id | INTEGER | NOT NULL, FK(CASCADE), INDEX | 所属会议 |
| name | VARCHAR(200) | NOT NULL | 姓名 |
| email | VARCHAR(200) | NOT NULL, INDEX | 邮箱 |
| source | VARCHAR(50) | DEFAULT 'manual' | `manual` / `committee_import` |
| created_at | DATETIME | DEFAULT NOW | 创建时间 |

**约束**：`UNIQUE(meeting_id, email)` — 同一会议同一邮箱唯一

---

### 3.16 audit_logs（审计日志表）

**用途**: 关键操作全量记录，只增不改，支持合规审计和问题追溯

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK, INDEX | 主键 |
| user_id | INTEGER | NOT NULL, FK(CASCADE), INDEX | 操作用户 |
| community_id | INTEGER | FK(CASCADE), NULLABLE, INDEX | 操作所在社区 |
| action | VARCHAR(100) | NOT NULL | 操作类型 |
| resource_type | VARCHAR(50) | NOT NULL | 资源类型 |
| resource_id | INTEGER | NULLABLE | 受影响资源 ID |
| details | JSON | DEFAULT {} | 详细信息（前后值等）|
| ip_address | VARCHAR(50) | NULLABLE | 客户端 IP |
| created_at | DATETIME | DEFAULT NOW, INDEX | 操作时间 |

**常见 `action` 值**：
`login`、`create_content`、`update_content`、`delete_content`、`publish_to_wechat`、`publish_to_hugo`、`create_community`、`create_committee`、`create_meeting`、`change_status`

**常见 `resource_type` 值**：
`user`、`community`、`content`、`channel_config`、`committee`、`meeting`

---

### 3.17 password_reset_tokens（密码重置令牌表）

**用途**: 存储密码重置链接中的一次性令牌

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | INTEGER | PK, INDEX | 主键 |
| user_id | INTEGER | NOT NULL, FK(users.id CASCADE) | 关联用户 |
| token | VARCHAR(200) | NOT NULL, UNIQUE, INDEX | 一次性令牌 |
| expires_at | DATETIME | NOT NULL | 过期时间（创建后 1 小时）|
| used | BOOLEAN | DEFAULT FALSE | 是否已使用 |
| created_at | DATETIME | DEFAULT NOW | 创建时间 |

**业务规则**：令牌有效期 1 小时，使用后标记 `used=True` 不可重复使用。

---

## 4. 索引设计总结

| 表名 | 索引字段 | 类型 | 用途 |
|------|---------|------|------|
| users | username | UNIQUE | 登录查询 |
| users | email | UNIQUE | 邮箱唯一 |
| communities | slug | UNIQUE | URL 路由 |
| community_users | (user_id, community_id) | UNIQUE | 防重复加入 |
| contents | community_id | BTREE | 社区过滤（最频繁）|
| contents | created_by_user_id | BTREE | 创建者查询 |
| contents | owner_id | BTREE | 所有者查询 |
| contents | scheduled_publish_at | BTREE | 日历范围查询 |
| contents | work_status | BTREE | 工作状态过滤 |
| content_assignees | content_id, user_id | BTREE | 责任人查询 |
| publish_records | community_id | BTREE | 社区发布统计 |
| channel_configs | (community_id, channel) | UNIQUE | 配置查询 |
| committees | community_id | BTREE | 社区委员会查询 |
| committees | (community_id, slug) | UNIQUE | slug 唯一性 |
| committee_members | committee_id | BTREE | 委员会成员查询 |
| meetings | committee_id | BTREE | 委员会会议查询 |
| meetings | community_id | BTREE | 社区会议查询 |
| meetings | scheduled_at | BTREE | 日历范围查询 |
| meetings | status / work_status | BTREE | 状态过滤 |
| meeting_reminders | (scheduled_at, status) | COMPOSITE | 定时任务查询待发提醒 |
| meeting_participants | (meeting_id, email) | UNIQUE | 防重复参会 |
| audit_logs | user_id | BTREE | 用户操作历史 |
| audit_logs | community_id | BTREE | 社区日志查询 |
| audit_logs | created_at | BTREE | 时间范围查询 |
| password_reset_tokens | token | UNIQUE | 令牌验证 |

---

## 5. 关键约束与业务规则汇总

| 约束 | 表 | 字段 | 说明 |
|------|-----|------|------|
| NOT NULL | meetings | committee_id | 必须先创建委员会 |
| NOT NULL | committees | slug | 创建时必须提供 |
| SET NULL | contents | created_by_user_id / owner_id | 用户删除时保留内容 |
| CASCADE | content_assignees | content_id / user_id | 内容或用户删除时清理 |
| CASCADE | meeting_assignees | meeting_id / user_id | 会议或用户删除时清理 |
| UNIQUE | community_users | (user_id, community_id) | 防重复加入社区 |
| UNIQUE | meeting_participants | (meeting_id, email) | 防重复参会 |
| UNIQUE | committees | (community_id, slug) | 社区内委员会 slug 唯一 |
| UNIQUE | channel_configs | (community_id, channel) | 每社区每渠道唯一配置 |

---

## 6. JSON 字段结构说明

**`communities.settings`**：
```json
{ "timezone": "Asia/Shanghai", "language": "zh-CN" }
```

**`contents.tags`**：
```json
["kubernetes", "cloud-native", "release"]
```

**`committee_members.roles`**（可多选）：
```json
["主席", "常务委员"]
```

**`meetings.attachments`**：
```json
[{"name": "会议材料.pdf", "url": "/uploads/files/xxx.pdf"}]
```

**`audit_logs.details`**：
```json
{
  "old_status": "draft",
  "new_status": "reviewing",
  "trigger": "manual_button_click"
}
```

---

## 7. 数据库配置

```python
# database.py
engine = create_engine(
    DATABASE_URL,
    pool_size=5,
    max_overflow=10,
    pool_pre_ping=True,
    echo=False
)
```

- 开发：`sqlite:///./opengecko.db`
- 生产：`postgresql://user:pass@host/opengecko`

---

## 8. 备份策略

**SQLite（开发环境）**：
```bash
sqlite3 opengecko.db ".backup opengecko_backup_$(date +%Y%m%d).db"
```

**PostgreSQL（生产环境）**：
```bash
# 每日凌晨 3 点全量备份，保留 30 天
pg_dump -U admin -Fc opengecko > opengecko_$(date +%Y%m%d).dump
find /backup/daily -name "*.dump" -mtime +30 -delete
```

---

**文档版本**: v3.0
**更新日期**: 2026-02-21（基于实际 SQLAlchemy 模型全量重写）
