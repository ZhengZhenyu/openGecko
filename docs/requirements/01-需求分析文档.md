# OmniContent - 需求分析文档

**文档版本**: v2.0
**编写日期**: 2026-02-06
**项目类型**: 企业级多社区内容管理平台
**目标用户**: 开源社区运营团队

---

## 1. 项目背景

### 1.1 业务背景
作为开源社区运营团队，需要管理多个开源社区的内容生产、审核、多渠道发布工作，并对内容发布后的效果进行监控和分析。当前面临的核心挑战：
- 社区数量多，内容管理分散，缺乏统一视图
- 多渠道（微信公众号、官网博客、CSDN、知乎）发布流程复杂且重复
- 缺少团队级别的内容策划工具（日历、看板）进行整体布局，对整个团队的内容管理进展缺乏可视化工具，难以跟踪内容状态和发布计划
- 发布效果数据分散，难以进行跨社区、跨渠道对比分析
- 缺少对内容状态流转的可视化工具，难以跟踪内容从创作到发布的全过程
- 缺少对读者群体的画像和内容偏好的分析工具，难以指导内容创作方向

### 1.2 项目目标
构建企业级多社区内容管理平台，实现：
1. **多租户架构**: 不同社区的统一管理和数据隔离
2. **专业化内容策划**: 日历视图和看板视图的双维度管理
3. **多渠道发布**: 一键发布到微信、Hugo博客、CSDN、知乎等平台
4. **数据驱动决策**: 多维度数据分析和可视化仪表板
5. **用户角色管理**: 超级管理员和社区成员的权限区分
6. **高性能和安全性**: 快速响应和严格的权限控制
7. **可扩展性**: 支持未来增加更多社区和发布渠道

### 1.3 项目范围

**本期范围**:
- 用户认证与权限管理（基础JWT）
- 多社区管理与数据隔离
- 内容日历视图（FullCalendar）
- 内容看板视图（Kanban）
- 数据分析仪表板（ECharts）
- 社区级渠道配置管理

**暂不包括**:
- 复杂的RBAC权限体系（仅实现基础角色）
- 内容协作（评论、@提醒）
- 工作流引擎（审批流可视化）
- 移动端适配

---

## 2. 用户角色定义

### 2.1 角色列表

| 角色 | 权限级别 | 职责描述 | 数量估计 |
|------|---------|---------|---------|
| **超级管理员** | 全局 | 创建社区、管理用户、跨社区访问 | 1-2人 |
| **社区成员** | 社区级 | 管理所属社区的内容、发布、配置 | 每社区3-5人 |

**说明**: 本期暂不实现复杂角色（编辑/审核/只读），所有社区成员拥有社区内全部权限。

### 2.2 用户画像

#### 超级管理员 
- **背景**: 开源基金会内容总监，管理12个开源社区
- **目标**:
  - 全局视角掌握所有社区内容产出情况
  - 快速创建新社区并分配负责人
  - 跨社区数据对比分析
- **痛点**:
  - 社区信息分散在不同系统
  - 缺少全局内容日历
  - 无法量化各社区运营效果

#### 社区运营专员 
- **背景**: xx社区运营，负责内容策划和发布
- **目标**:
  - 在日历上提前规划本月发布计划
  - 看板视图跟踪内容审核进度
  - 一键发布到4个平台节省时间
- **痛点**:
  - 手动复制粘贴内容到各平台效率低
  - 微信公众号格式调整繁琐
  - 发布后数据需要手动统计

---

## 3. 功能需求

### 3.1 功能模块概览

```
OmniContent
├── 用户认证模块 (Authentication)
│   ├── 登录/登出
│   ├── Token管理
│   └── 用户信息管理
│
├── 社区管理模块 (Community Management)
│   ├── 社区CRUD
│   ├── 社区切换
│   └── 成员管理
│
├── 内容管理模块 (Content Management)
│   ├── 内容CRUD
│   ├── WORD文件上传转换
│   ├── Markdown编辑器
│   ├── 封面图管理
│   └── 内容状态流转
│
├── 内容策划模块 (Content Planning) ⭐新增
│   ├── 日历视图
│   ├── 看板视图
│   └── 拖拽排期
│
├── 多渠道发布模块 (Multi-Channel Publishing)
│   ├── 微信公众号发布
│   ├── Hugo博客生成
│   ├── CSDN格式输出
│   └── 知乎格式输出
│
├── 数据分析模块 (Analytics) ⭐新增
│   ├── 多维度统计
│   ├── 可视化图表
│   └── 趋势分析
│
└── 渠道配置模块 (Channel Configuration)
    ├── 社区级配置隔离
    └── 配置启用/禁用
```

### 3.2 核心功能需求详述

#### FR-1: 用户认证模块

**FR-1.1 用户登录**
- **描述**: 用户通过用户名和密码登录系统
- **输入**: 用户名、密码
- **输出**: JWT Token（有效期7天）
- **前置条件**: 用户账号已由超管创建
- **后置条件**: Token存储到localStorage，用于后续API调用
- **业务规则**:
  - 密码使用bcrypt哈希存储
  - 登录失败不暴露具体原因（用户名不存在/密码错误）
- **优先级**: P0

**FR-1.2 Token自动刷新**
- **描述**: Token过期后自动跳转到登录页
- **触发条件**: API返回401状态码
- **优先级**: P0

**FR-1.3 获取用户信息**
- **接口**: `GET /api/auth/me`
- **返回**: 用户基本信息 + 可访问的社区列表
- **优先级**: P0

---

#### FR-2: 社区管理模块

**FR-2.1 社区CRUD**
- **创建社区**:
  - 权限：仅超级管理员
  - 必填：社区名称、slug（URL标识）
  - 可选：描述、Logo
- **社区列表**: 显示当前用户可访问的所有社区
- **社区详情**: 显示成员、配置、统计数据
- **更新社区**: 修改名称、描述、Logo
- **删除社区**: 仅超管，需二次确认（级联删除相关数据）
- **优先级**: P0

**FR-2.2 社区切换器**
- **位置**: 全局导航栏
- **交互**: 下拉选择框
- **行为**: 切换后刷新页面，所有数据自动过滤到新社区
- **存储**: 当前社区ID存储到localStorage
- **优先级**: P0

**FR-2.3 成员管理**
- **添加成员**: 超管将用户分配到社区
- **移除成员**: 超管从社区移除用户
- **成员列表**: 显示社区所有成员及加入时间
- **优先级**: P1

---

#### FR-3: 内容管理模块

**FR-3.1 内容CRUD**
- **创建内容**:
  - 手动创建：填写标题、Markdown正文、元数据
  - 文件上传：支持.docx、.md文件自动转换
- **内容列表**:
  - 分页展示（每页20条）
  - 筛选：状态、来源类型、关键词搜索
  - 排序：按更新时间倒序
- **内容编辑**:
  - Markdown编辑器（md-editor-v3）
  - 实时预览
  - 元数据：作者、分类、标签、来源类型
  - 封面图上传（2.35:1比例建议）
- **内容删除**: 软删除（状态改为archived）
- **优先级**: P0

**FR-3.2 内容状态管理**
- **状态流转**:
  ```
  draft（草稿） → reviewing（审核中） → approved（已通过） → published（已发布）
  ```
- **状态颜色**:
  - draft: 灰色
  - reviewing: 橙色
  - approved: 蓝色
  - published: 绿色
- **修改方式**:
  - 手动切换（下拉选择）
  - 看板拖拽
- **优先级**: P0

**FR-3.3 WORD文件处理**
- **支持格式**: .docx
- **转换流程**: DOCX → HTML → Markdown
- **图片处理**: 提取到uploads/images/目录，Markdown中使用相对路径
- **保留格式**: 标题、加粗、斜体、列表、表格、代码块
- **优先级**: P0

---

#### FR-4: 内容策划模块 ⭐新增

**FR-4.1 日历视图**
- **布局**: FullCalendar月视图
- **显示内容**:
  - 已设置计划发布时间（scheduled_publish_at）的内容
  - 事件标题显示内容标题
  - 背景色根据状态区分
- **交互功能**:
  - **拖拽排期**: 将内容拖拽到指定日期，自动更新scheduled_publish_at
  - **点击日期**: 弹出对话框，可选择草稿内容并设置发布时间
  - **点击事件**: 跳转到内容编辑页
- **筛选**: 按状态、分类过滤
- **视图切换**: 月视图 / 周视图
- **优先级**: P0

**FR-4.2 看板视图**
- **布局**: 4列Kanban（draft / reviewing / approved / published）
- **卡片内容**:
  - 标题
  - 作者
  - 封面图缩略图
  - 标签
  - 更新时间
- **交互功能**:
  - **拖拽改状态**: 将卡片在列之间拖动，自动更新状态
  - **点击卡片**: 跳转到编辑页
  - **快捷菜单**: 编辑、发布、删除
- **筛选**: 按作者、分类、时间范围
- **统计**: 每列顶部显示数量
- **优先级**: P0

**FR-4.3 拖拽操作审计**
- **记录内容**:
  - 谁（用户）
  - 何时（时间戳）
  - 做了什么（从状态A拖到状态B / 从日期X改到日期Y）
- **存储位置**: audit_logs表
- **查询**: 支持按用户、时间范围查询操作历史
- **优先级**: P1

---

#### FR-5: 多渠道发布模块

**FR-5.1 微信公众号发布**
- **前置条件**:
  - 社区已配置微信AppID和AppSecret
  - 内容已设置封面图（必需）
- **发布流程**:
  1. 自动上传封面图到微信素材库（永久素材）
  2. 转换Markdown为微信兼容HTML（内联样式）
  3. 调用API创建草稿
  4. 返回草稿预览链接
- **后置操作**: 用户在微信公众号后台确认发布
- **错误处理**:
  - AppID/Secret错误：提示"微信配置错误"
  - 封面图缺失：提示"请先上传封面图"
  - 图片过大：自动压缩到10MB以内
- **优先级**: P0

**FR-5.2 Hugo博客生成**
- **前置条件**: 社区已配置Hugo仓库路径
- **生成内容**:
  - YAML front matter（标题、日期、作者、标签、分类）
  - Markdown正文
- **输出路径**: `{HUGO_REPO_PATH}/content/posts/{slug}.md`
- **文件名**: 使用内容ID或标题slug
- **优先级**: P0

**FR-5.3 CSDN格式输出**
- **方式**: 生成格式化Markdown，提供一键复制按钮
- **格式增强**:
  - 添加开头引言
  - 代码块语言标注
  - 文末添加来源声明
- **优先级**: P1

**FR-5.4 知乎格式输出**
- **方式**: 转换为知乎兼容HTML，提供一键复制
- **样式处理**: 内联CSS样式
- **图片处理**: 外链图片URL
- **优先级**: P1

**FR-5.5 发布记录**
- **记录内容**:
  - 内容ID、渠道、发布时间
  - 平台文章ID、平台URL
  - 发布状态（成功/失败）
  - 错误信息（如有）
- **查询**: 按内容、按渠道、按时间范围
- **优先级**: P0

---

#### FR-6: 数据分析模块 ⭐新增

**FR-6.1 数据分析仪表板**
- **图表类型**:
  1. **渠道发布量柱状图**: 横轴-渠道，纵轴-发布数量
  2. **发布趋势折线图**: 横轴-日期（最近30天），纵轴-发布量
  3. **作者贡献排名**: 横向柱状图，显示TOP 10作者
  4. **分类分布饼图**: 各分类占比
- **时间筛选**: 最近7天 / 30天 / 90天 / 自定义
- **社区筛选**: 切换社区后数据自动刷新
- **优先级**: P0

**FR-6.2 多维度统计API**
- **按渠道分组**:
  - 接口: `GET /api/analytics/by-channel`
  - 返回: `[{channel: "wechat", count: 25, read_count: 5000}, ...]`
- **按作者分组**:
  - 接口: `GET /api/analytics/by-author`
  - 返回: `[{author: "张三", count: 12}, ...]`
- **趋势数据**:
  - 接口: `GET /api/analytics/trend?days=30`
  - 返回: `{dates: [...], counts: [...]}`
- **优先级**: P0

**FR-6.3 内容阅读数据采集**
- **数据来源**:
  - 微信公众号：通过API定期同步
  - Hugo博客：Google Analytics（手动导入）
  - CSDN/知乎：手动录入
- **存储**: content_analytics表
- **展示**: 内容详情页显示各渠道数据
- **优先级**: P2（手动录入）

---

#### FR-7: 渠道配置模块

**FR-7.1 社区级配置隔离**
- **设计原则**: 每个社区有独立的渠道配置
- **数据库约束**: UNIQUE(community_id, channel)
- **继承关系**: 无继承，各社区完全独立
- **优先级**: P0

**FR-7.2 微信公众号配置**
- **配置项**:
  - AppID（必填）
  - AppSecret（必填，密码框显示）
  - 启用/禁用开关
- **验证**: 保存时调用微信API验证配置有效性
- **优先级**: P0

**FR-7.3 Hugo博客配置**
- **配置项**:
  - 仓库路径（本地绝对路径）
  - content目录（默认content/posts）
  - 启用/禁用开关
- **验证**: 检查路径是否存在且可写
- **优先级**: P0

---

## 4. 非功能需求

### 4.1 性能需求

| 指标 | 要求 | 测量方法 |
|------|------|---------|
| API响应时间 | 95%请求 < 500ms | 后端日志统计 |
| 页面加载时间 | 首屏 < 2s | Lighthouse评分 |
| 日历渲染性能 | 100条事件 < 1s | Chrome DevTools |
| 看板拖拽流畅度 | 60fps无卡顿 | Performance监控 |
| 并发用户数 | 支持50用户同时在线 | 压力测试 |
| 数据库查询 | 单查询 < 100ms | SQLAlchemy日志 |

### 4.2 安全需求

| 类别 | 要求 |
|------|------|
| 身份认证 | JWT Token，HTTPS传输 |
| 密码存储 | bcrypt哈希，不可逆 |
| XSS防护 | 输入转义，CSP策略 |
| CSRF防护 | SameSite Cookie，CORS限制 |
| SQL注入防护 | ORM参数化查询 |
| 文件上传安全 | 白名单扩展名，病毒扫描 |
| 敏感信息保护 | AppSecret加密存储 |
| 操作审计 | 关键操作记录到audit_logs |

### 4.3 可用性需求

| 指标 | 要求 |
|------|------|
| 系统可用性 | 99.5%（月停机时间<3.6小时） |
| 错误恢复 | 前端错误边界，后端异常捕获 |
| 数据备份 | 每日自动备份数据库 |
| 日志保留 | 审计日志永久保留，系统日志30天 |

### 4.4 兼容性需求

| 类别 | 支持范围 |
|------|---------|
| 浏览器 | Chrome 90+, Firefox 88+, Safari 14+, Edge 90+ |
| 操作系统 | macOS 11+, Windows 10+, Ubuntu 20.04+ |
| 屏幕分辨率 | 最小1366x768 |
| 移动端 | 暂不支持 |

### 4.5 可扩展性需求

- **社区数量**: 支持20+社区
- **用户数量**: 支持50+用户
- **内容数量**: 支持100,000+内容记录
- **新渠道接入**: 插件化架构，便于扩展新发布渠道

### 4.6 可维护性需求

- **代码规范**: ESLint + Prettier（前端），Black（后端）
- **测试覆盖**: 核心业务逻辑>80%
- **文档完整性**: API文档（OpenAPI）、部署文档、用户手册
- **日志规范**: 结构化日志（JSON格式）

---

## 5. 数据需求

### 5.1 数据量估算

**单社区数据量**（以openEuler社区为例）:
- 内容：月产出20篇，年累计240篇
- 发布记录：每篇4个渠道，年累计960条
- 审计日志：每篇10次操作，年累计2400条

**10个社区合计**:
- 内容：年累计2400篇
- 发布记录：年累计9600条
- 审计日志：年累计24000条
- 用户：50人
- 社区：10个

**5年数据量预估**:
- 内容：12,000条
- 发布记录：48,000条
- 审计日志：120,000条

### 5.2 数据备份策略

- **全量备份**: 每日凌晨3点，保留30天
- **增量备份**: 每6小时，保留7天
- **异地备份**: 每周同步到云存储
- **恢复测试**: 每月执行恢复演练

### 5.3 数据保留策略

| 数据类型 | 保留期限 | 清理策略 |
|---------|---------|---------|
| 内容记录 | 永久 | 软删除，归档 |
| 发布记录 | 永久 | - |
| 审计日志 | 永久 | 超过3年归档到冷存储 |
| 上传文件 | 永久 | 删除内容时级联删除 |
| 系统日志 | 30天 | 定期清理 |

---

## 6. 约束条件

### 6.1 技术约束

- **编程语言**: Python 3.11+（后端），TypeScript 5.0+（前端）
- **数据库**: SQLite 3.35+（可升级PostgreSQL）
- **Web框架**: FastAPI 0.100+
- **前端框架**: Vue 3.3+
- **部署方式**: Docker Compose

### 6.2 业务约束

- **认证方式**: 暂不支持第三方登录（OAuth）
- **权限模型**: 仅区分超管和普通成员，不支持细粒度权限
- **社区隔离**: 严格隔离，用户不能跨社区访问数据（除超管）
- **并发编辑**: 不支持，后保存覆盖先保存（乐观锁）

### 6.3 时间约束

- **Phase 1**: 2周（认证+社区隔离）
- **Phase 2**: 1.5周（日历视图）
- **Phase 3**: 1.5周（看板视图）
- **Phase 4**: 2周（数据分析）
- **总工期**: 7周

### 6.4 成本约束

- **开发成本**: 1名全栈工程师
- **运维成本**: 单台服务器（4核8GB）
- **第三方服务**: 微信公众号认证费用（300元/年）

---

## 7. 验收标准

### 7.1 功能验收

| 模块 | 验收标准 |
|------|---------|
| 用户认证 | 登录、登出、Token过期跳转正常工作 |
| 社区管理 | 创建10个社区，切换社区数据正确隔离 |
| 内容管理 | 上传DOCX正确转换，Markdown编辑保存无误 |
| 日历视图 | 拖拽内容到指定日期，scheduled_publish_at正确更新 |
| 看板视图 | 拖拽卡片改变状态，审计日志正确记录 |
| 微信发布 | 成功创建草稿，返回预览链接 |
| 数据分析 | 4个图表正确展示，切换社区数据刷新 |

### 7.2 性能验收

- 日历加载100条事件<1秒
- 看板拖拽操作无明显延迟
- 发布到微信<3秒返回结果
- 仪表板图表渲染<2秒

### 7.3 安全验收

- 非登录用户访问受保护资源返回401
- 普通用户无法访问其他社区数据（返回403）
- 密码在数据库中以哈希形式存储
- 文件上传仅接受白名单格式

### 7.4 文档验收

- API文档完整（Swagger UI）
- 部署文档可按步骤成功部署
- 用户手册包含所有核心操作截图

---

## 8. 风险与应对

### 8.1 技术风险

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|---------|
| FullCalendar性能问题 | 中 | 高 | 分页加载，限制单页事件数量 |
| 微信API限制 | 低 | 高 | 配置多个公众号账号，轮询使用 |
| SQLite并发瓶颈 | 中 | 中 | 预留PostgreSQL迁移方案 |
| 大文件上传超时 | 中 | 中 | 分片上传，服务器超时配置 |

### 8.2 业务风险

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|---------|
| 用户需求变更 | 高 | 中 | 分阶段交付，快速迭代 |
| 社区数量超预期 | 中 | 中 | 数据库索引优化，分库分表预案 |
| 并发冲突 | 低 | 低 | 提示用户刷新页面重新编辑 |

---

## 9. 术语表

| 术语 | 英文 | 定义 |
|------|------|------|
| 社区 | Community | 独立的内容管理单元，数据隔离 |
| 多租户 | Multi-Tenancy | 多个社区共享同一套系统，数据隔离 |
| JWT | JSON Web Token | 无状态认证Token |
| 内容 | Content | 需要发布的文章、Release Note、活动总结等 |
| 渠道 | Channel | 发布目标平台（微信、Hugo、CSDN、知乎） |
| 看板 | Kanban | 可视化工作流管理方式 |
| 审计日志 | Audit Log | 记录用户关键操作的日志 |
| 封面图 | Cover Image | 微信公众号发布必需的头图 |
| 计划发布时间 | Scheduled Publish At | 内容预定发布的日期时间 |

---

## 10. 附录

### 10.1 参考资料

- 微信公众平台技术文档: https://developers.weixin.qq.com/doc/offiaccount/
- FullCalendar官方文档: https://fullcalendar.io/docs
- ECharts官方文档: https://echarts.apache.org/

### 10.2 变更记录

| 版本 | 日期 | 变更内容 | 编写人 |
|------|------|---------|--------|
| v1.0 | 2025-12 | 初始版本（单租户） | 开发团队 |
| v2.0 | 2026-02-06 | 升级为多租户架构，增加日历/看板/分析功能 | 开发团队 |

---

**文档状态**: ✅ 已评审通过
**评审人**: 产品负责人、技术负责人
**评审日期**: 2026-02-06
